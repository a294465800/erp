"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};$(document).ready(function(){function e(){var e=$(this).val(),i=$(this).parents(".win-item").find(".ho_span");e?i.text(e):i.text("单位")}function i(e){return function(){var i=$(this).parents(e),n=$(this).parents(".data-dom"),a=n.data("name");d(a=a.replace(/index/i,n.data("index")),void 0),i.fadeOut(300,"swing",function(){i.remove()})}}function n(e){e.on("blur",function(){var e=$(this);if(e.hasClass("search")&&(e=e.siblings(".real-search")),""===e.val())return!1;(function(){var e=this.attr("name"),i=this.val(),n=/(index)/;if(n.test(e)){var a=this.parents(".data-dom").data("index");e=e.replace(n,a)}d(e,i)}).call(e)})}_helper.setActiveNav("#navProject",".list"),laydate.render({elem:"#createDate",done:function(e,i){d("signDate",e)}}),laydate.render({elem:"#completeDate",done:function(e,i){d("completeDate",e)}}),laydate.render({elem:"#margins0",done:function(e,i){d("margins[0].date",e)}});var a={data:_database.read("projects")};function d(e,i){_database.setValue("projects",e,i),console.log(a.data)}var t=$("#winBid");$(".win-company").on("blur",e),$("#addNewBid").on("click",function(){var i=_database.create("projects","masterCompany"),a=$('<div class="win-item data-dom" data-id='+i.id+' data-index="'+i.index+'" data-name="masterCompany[index]"></div>');a.html('\n        <div class="inline fields">\n          <div class="eight wide field fields">\n            <label class="five wide field">单位名称</label>\n            <input name="masterCompany[index].name" type="text" placeholder="请输入单位名称" class="win-company" required>\n          </div>\n          <div class="eight wide field fields">\n            <label class="five wide field">金额</label>\n            <div class="ui right labeled input">\n              <input name="masterCompany[index].amount" type="number" placeholder="请输入金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <div class="eight wide field fields">\n            <label class="five wide field">备注</label>\n            <textarea name="masterCompany[index].remark" rows="2" placeholder="请输入备注"></textarea>\n          </div>\n          <div class="eight wide field fields relative">\n            <div class="win-remove-btn ui button red">\n              <i class="icon remove"></i>\n              <span>删除该项</span>\n            </div>\n          </div>\n        </div>\n        <h4 class="ui horizontal divider header">\n          <i class="icon travel"></i>\n          <span class="ho_span">单位</span>\n        </h4>'),a.find(".win-company").on("blur",e),n(a.find("input")),n(a.find("textarea")),a.css("opacity",0),a.insertBefore($(this).parent()),a.animate({opacity:1},500)}),t.on("click",".win-remove-btn",i(".win-item"));var l=$("#divideBid");$("#addNewDivideBid").on("click",function(){var i=_database.create("projects","subCompany"),a=$('<div class="win-item data-dom" data-id='+i.id+' data-index="'+i.index+'" data-name="subCompany[index]"></div>');a.html('\n        <div class="inline fields">\n          <div class="eight wide field fields">\n            <label class="five wide field">发包单位</label>\n            <input name="subCompany[index].name" type="text" placeholder="请输入发包单位" class="win-company" required>\n          </div>\n          <div class="eight wide field fields">\n            <label class="five wide field">分包金额</label>\n            <div class="ui right labeled input">\n              <input name="subCompany[index].amount" type="number" placeholder="请输入分包金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n        </div>\n        <div class="inline fields">\n          <div class="eight wide field fields">\n            <label class="five wide field">备注</label>\n            <textarea name="subCompany[index].remark" rows="2" placeholder="请输入备注"></textarea>\n          </div>\n          <div class="eight wide field fields relative">\n            <div class="win-remove-btn ui button red">\n              <i class="icon remove"></i>\n              <span>删除该项</span>\n            </div>\n          </div>\n        </div>\n        <h4 class="ui horizontal divider header">\n          <i class="icon travel"></i>\n          <span class="ho_span">单位</span>\n        </h4>'),a.find(".win-company").on("blur",e),n(a.find("input")),n(a.find("textarea")),a.css("opacity",0),a.insertBefore($(this).parent()),a.animate({opacity:1},500)}),l.on("click",".win-remove-btn",i(".win-item"));var s=$("#detailItem");function c(e){var i=_database.create("projects","masterContract["+e+"].details"),a=$('<div class="field detail-item data-dom"  data-id='+i.id+' data-index="'+i.index+'" data-name="masterContract['+e+"].details["+i.index+']"></div>'),d=$("#contentSelects").html(),t=$("#taxSelects").html(),l='\n        <div class="three fields">\n          <div class="field">\n            <label>内容名称</label>\n            <div class="ui fluid search selection dropdown">\n              <input type="hidden" class="real-search" name="masterContract['+e+"].details["+i.index+'].name" required>\n              <i class="dropdown icon"></i>\n              <div class="default text">请选择内容</div>\n              <div class="menu">\n              '+d+'\n              </div>\n            </div>\n          </div>\n          <div class="field">\n            <label>税率</label>\n            <div class="ui fluid search selection dropdown">\n              <input type="hidden" class="real-search" name="masterContract['+e+"].details["+i.index+'].tax" required>\n              <i class="dropdown icon"></i>\n              <div class="default text">请选择税率</div>\n              <div class="menu">\n              '+t+'\n              </div>\n            </div>\n          </div>\n          <div class="field">\n            <label>金额</label>\n            <div class="ui right labeled input">\n              <input type="number" name="masterContract['+e+"].details["+i.index+'].amount" placeholder="金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n        </div>\n        <div class="two fields">\n          <div class="field">\n            <label>备注</label>\n            <textarea name="masterContract['+e+"].details["+i.index+'].remark" rows="2" placeholder="请输入备注" required></textarea>\n          </div>\n          <div class="field relative">\n            <label class="invisible">按钮</label>\n            <div class=" ui button red project-item-del">\n              <i class="icon remove"></i>\n              <span>删除该项</span>\n            </div>\n          </div>\n        </div>';a.html(l),a.find(".dropdown").dropdown(),n(a.find("input")),n(a.find("textarea")),a.css("opacity",0),a.insertBefore($(this).parent()),a.animate({opacity:1},500)}function r(e){var i=_database.create("projects","subContract["+e+"].details"),a=$('<div class="field detail-item data-dom" data-id='+i.id+' data-index="'+i.index+'" data-name="subContract['+e+'].details[index]"></div>'),d=$("#contentSelects").html(),t=$("#taxSelects").html(),l='\n        <div class="three fields">\n        <div class="field">\n          <label>内容名称</label>\n          <div class="ui fluid search selection dropdown">\n            <input type="hidden" class="real-search" name="subContract['+e+"].details["+i.index+'].name" required>\n            <i class="dropdown icon"></i>\n            <div class="default text">请选择内容</div>\n            <div class="menu">\n            '+d+'\n            </div>\n          </div>\n        </div>\n        <div class="field">\n          <label>税率</label>\n          <div class="ui fluid search selection dropdown">\n            <input type="hidden" class="real-search" name="subContract['+e+"].details["+i.index+'].tax" required>\n            <i class="dropdown icon"></i>\n            <div class="default text">请选择税率</div>\n            <div class="menu">\n            '+t+'\n            </div>\n          </div>\n        </div>\n          <div class="field">\n            <label>金额</label>\n            <div class="ui right labeled input">\n              <input type="number" name="subContract['+e+"].details["+i.index+'].amount" placeholder="金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n        </div>\n        <div class="two fields">\n          <div class="field">\n            <label>备注</label>\n            <textarea name="subContract['+e+"].details["+i.index+'].remark" rows="2" placeholder="请输入备注"></textarea>\n          </div>\n          <div class="field relative">\n            <label class="invisible">按钮</label>\n            <div class=" ui button red project-item-del">\n              <i class="icon remove"></i>\n              <span>删除该项</span>\n            </div>\n          </div>\n        </div>';a.html(l),a.find(".dropdown").dropdown(),n(a.find("input")),n(a.find("textarea")),a.css("opacity",0),a.insertBefore($(this).parent()),a.animate({opacity:1},500)}$(".addBidNewItem").on("click",function(){c.call(this,0)}),$("#addNewMasterAppend").on("click",function(){var e=_database.create("projects","masterContract");_database.setValue("projects","masterContract["+e.index+"].details",[]);var i=_database.create("projects","masterContract["+e.index+"].details"),a=$('<div class="contract-item">'),d=$("#contentSelects").html(),t=$("#taxSelects").html(),l='\n        <div class="inline fields data-dom"  data-id=1 data-index=0 data-name="masterContract['+e.index+']">\n          <div class="eight wide field fields">\n            <label class="five wide field">后期追加或减少金额</label>\n            <div class="ui right labeled input">\n              <input name="masterContract['+e.index+']].amount" type="number" placeholder="请输入后期追加或减少金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n          <div class="eight wide field fields relative">\n            <label class="invisible">按钮</label>\n            <div class=" ui button red project-append-item-del">\n              <i class="icon remove"></i>\n              <span>删除该追加项</span>\n            </div>\n          </div>\n        </div>\n        <div class="field detail-item data-dom" data-id=1 data-index=0 data-name="masterContract['+e.index+"].details["+i.index+']">\n          <div class="three fields">\n          <div class="field">\n            <label>内容名称</label>\n            <div class="ui fluid search selection dropdown">\n              <input type="hidden" class="real-search" name="masterContract['+e.index+"].details["+i.index+'].name" required>\n              <i class="dropdown icon"></i>\n              <div class="default text">请选择内容</div>\n              <div class="menu">\n              '+d+'\n              </div>\n            </div>\n          </div>\n          <div class="field">\n            <label>税率</label>\n            <div class="ui fluid search selection dropdown">\n              <input type="hidden" class="real-search" name="masterContract['+e.index+"].details["+i.index+'].tax" required>\n              <i class="dropdown icon"></i>\n              <div class="default text">请选择税率</div>\n              <div class="menu">\n              '+t+'\n              </div>\n            </div>\n          </div>\n            <div class="field">\n              <label>金额</label>\n              <div class="ui right labeled input">\n                <input type="number" name="masterContract['+e.index+"].details["+i.index+'].amount" placeholder="金额" required>\n                <div class="ui basic label">￥</div>\n              </div>\n            </div>\n          </div>\n          <div class="two fields">\n            <div class="field">\n              <label>备注</label>\n              <textarea name="masterContract['+e.index+"].details["+i.index+'].remark" rows="2" placeholder="请输入备注"></textarea>\n            </div>\n            <div class="field relative">\n              <label class="invisible">按钮</label>\n              <div class=" ui button red project-item-del">\n                <i class="icon remove"></i>\n                <span>删除该项</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="ui center aligned basic segment">\n          <div class="ui blue labeled icon button addBidNewItem">\n            <span>新增内容</span>\n            <i class="add icon"></i>\n          </div>\n        </div>';a.html(l),a.find(".dropdown").dropdown(),n(a.find("input")),n(a.find("textarea")),a.find(".addBidNewItem").on("click",function(){c.call(this,e.index)}),a.css("opacity",0),a.insertBefore($(this).parent()),a.animate({opacity:1},500)}),s.on("click",".project-item-del",i(".detail-item")),s.on("click",".project-append-item-del",i(".contract-item")),$(".addBidDivideNewItem").on("click",function(){r.call(this,0)}),$("#addNewSubAppend").on("click",function(){var e=_database.create("projects","subContract");_database.setValue("projects","subContract["+e.index+"].details",[]);var i=_database.create("projects","subContract["+e.index+"].details"),a=$('<div class="contract-item">'),d=$("#contentSelects").html(),t=$("#taxSelects").html(),l='\n        <div class="inline fields data-dom"  data-id=1 data-index=0 data-name="subContract['+e.index+']">\n          <div class="eight wide field fields">\n            <label class="five wide field">后期追加或减少金额</label>\n            <div class="ui right labeled input">\n              <input name="subContract['+e.index+']].amount" type="number" placeholder="请输入后期追加或减少金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n          <div class="eight wide field fields relative">\n            <label class="invisible">按钮</label>\n            <div class=" ui button red project-append-item-del">\n              <i class="icon remove"></i>\n              <span>删除该追加项</span>\n            </div>\n          </div>\n        </div>\n        <div class="field detail-item data-dom" data-id=1 data-index=0 data-name="subContract['+e.index+"].details["+i.index+']">\n          <div class="three fields">\n          <div class="field">\n            <label>内容名称</label>\n            <div class="ui fluid search selection dropdown">\n              <input type="hidden" class="real-search" name="subContract['+e.index+"].details["+i.index+'].name" required>\n              <i class="dropdown icon"></i>\n              <div class="default text">请选择内容</div>\n              <div class="menu">\n              '+d+'\n              </div>\n            </div>\n          </div>\n          <div class="field">\n            <label>税率</label>\n            <div class="ui fluid search selection dropdown">\n              <input type="hidden" class="real-search" name="subContract['+e.index+"].details["+i.index+'].tax" required>\n              <i class="dropdown icon"></i>\n              <div class="default text">请选择税率</div>\n              <div class="menu">\n              '+t+'\n              </div>\n            </div>\n          </div>\n            <div class="field">\n              <label>金额</label>\n              <div class="ui right labeled input">\n                <input type="number" name="subContract['+e.index+"].details["+i.index+'].amount" placeholder="金额" required>\n                <div class="ui basic label">￥</div>\n              </div>\n            </div>\n          </div>\n          <div class="two fields">\n            <div class="field">\n              <label>备注</label>\n              <textarea name="subContract['+e.index+"].details["+i.index+'].remark" rows="2" placeholder="请输入备注"></textarea>\n            </div>\n            <div class="field relative">\n              <label class="invisible">按钮</label>\n              <div class=" ui button red project-item-del">\n                <i class="icon remove"></i>\n                <span>删除该项</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="ui center aligned basic segment">\n          <div class="ui blue labeled icon button addBidDivideNewItem">\n            <span>新增内容</span>\n            <i class="add icon"></i>\n          </div>\n        </div>';a.html(l),a.find(".dropdown").dropdown(),n(a.find("input")),n(a.find("textarea")),a.find(".addBidDivideNewItem").on("click",function(){r.call(this,e.index)}),a.css("opacity",0),a.insertBefore($(this).parent()),a.animate({opacity:1},500)}),$(".checkContract").on("click",function(){var e=$(this);e.addClass("loading");var i,n=e.data("name"),a=_database.read("projects",n);(i=a,new Promise(function(e,n){i.length<1&&n({code:400,msg:"参数错误！"});var a=[],d={},t=0,l=!0;i.forEach(function(e,i){if(e&&void 0!==e.amount){var n=parseFloat(e.amount||0);if(e.details&&e.details.length>0){var s=0;e.details.forEach(function(e,i){if(e&&void 0!==e.amount){var n=parseFloat(e.amount);s+=n,d[e.name]=(d[e.name]?d[e.name]:0)+n}});var c={mainAmount:n,subAmount:s,result:"success"};n!==s&&(c.result="error",l=!1),a.push(c),t+=n}}}),e(l?{code:200,msg:"核对成功",data:{result:a,details:d,totalAmount:t}}:{code:204,msg:"核对失败",data:{result:a,details:d,totalAmount:t}})})).then(function(i){e.removeClass("loading"),200===i.code?(e.removeClass("teal red"),e.addClass("green"),e.find("span").text(i.msg)):(e.removeClass("teal green"),e.addClass("red"),e.find("span").text(i.msg)),function(e,i){if(0!==e.totalAmount){var n=e.details,a=e.totalAmount+" ￥",d=!1,t="";for(var l in n)d?t+="\n            <tr>\n              <td>"+l+"</td>\n              <td>￥"+n[l]+"</td>\n            </tr>":(t+='\n              <tr>\n                <td rowspan="3" class="center aligned">'+a+"</td>\n                <td>"+l+"</td>\n                <td>￥"+n[l]+"</td>\n              </tr>",d=!0);var s='\n          <table class="ui celled structured table">\n            <thead>\n              <tr>\n                <th rowspan="3" class="center aligned">'+("masterContract"===i?"主合同金额":"分包合同金额")+'</th>\n                <th colspan="2" class="center aligned">具体内容</th>\n              </tr>\n              <tr>\n                <th>内容</th>\n                <th>金额</th>\n              </tr>\n            </thead>\n            <tbody>\n              '+t+"\n            </tbody>\n          </table>",c=$(this.parent().next(".check-result")[0]);c.css("opacity",0),c.html(s),c.animate({opacity:1},500)}}.call(e,i.data,n)}).catch(function(i){e.removeClass("teal green loading"),e.addClass("red"),e.find("span").text(i.msg)})}),$("#addMarginItem").on("click",function(){var e=_database.create("projects","margins"),i=$('<div class="field data-dom" data-id='+e.id+" data-index="+e.index+' data-name="margins[index]"></div>'),a='\n        <div class="three fields">\n          <div class="field">\n            <label>支付日期</label>\n            <input type="text" id="margins'+e.index+'" name="margins[index].date" placeholder="请选择日期" required>\n          </div>\n          <div class="field">\n            <label>支付金额</label>\n            <div class="ui right labeled input">\n              <input type="number" name="margins[index].amount" placeholder="金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n          <div class="field">\n            <label>收款人</label>\n            <input type="text" name="margins[index].payee" placeholder="请输入收款人" required>\n          </div>\n        </div>\n        <div class="two fields">\n          <div class="field">\n            <label>回收条件</label>\n            <textarea name="margins[index].recycle" rows="2" placeholder="请输入回收条件"></textarea>\n          </div>\n          <div class="field relative">\n            <label class="invisible">按钮</label>\n            <div class=" ui button red project-item-del">\n              <i class="icon remove"></i>\n              <span>删除该项</span>\n            </div>\n          </div>\n        </div>\n        <h4 class="ui horizontal divider header">\n          <i class="icon remove bookmark"></i>\n        </h4>';i.html(a),n(i.find("input")),n(i.find("textarea")),i.css("opacity",0),i.insertBefore($(this).parent()),laydate.render({elem:"#margins"+e.index,done:function(i,n){d("margins["+e.index+"].date",i)}}),i.animate({opacity:1},500)}),$("#marginsItem").on("click",".project-item-del",i(".data-dom")),$("#addConditionItem").on("click",function(){var e=_database.create("projects","paymentConditions"),i=$('<div class="field data-dom" data-id='+e.id+" data-index="+e.index+' data-name="paymentConditions[index]"></div>');i.html('\n        <div class="two fields">\n          <div class="field">\n            <label>收款比例</label>\n            <div class="ui right labeled input">\n              <input type="number" name="paymentConditions[index].rate" placeholder="请输入收款比例" required>\n              <div class="ui basic label">%</div>\n            </div>\n          </div>\n          <div class="field">\n            <label>预计金额</label>\n            <div class="ui right labeled input">\n              <input type="number" name="paymentConditions[index].expected" placeholder="请输入预计金额" required>\n              <div class="ui basic label">￥</div>\n            </div>\n          </div>\n        </div>\n        <div class="two fields">\n          <div class="field">\n            <label>收款条件</label>\n            <textarea name="paymentConditions[index].condition" rows="2" placeholder="请输入收款条件"></textarea>\n          </div>\n          <div class="field relative">\n            <label class="invisible">按钮</label>\n            <div class=" ui button red project-item-del">\n              <i class="icon remove"></i>\n              <span>删除该项</span>\n            </div>\n          </div>\n        </div>\n        <h4 class="ui horizontal divider header ">\n          <i class="icon remove bookmark"></i>\n        </h4>'),n(i.find("input")),n(i.find("textarea")),i.css("opacity",0),i.insertBefore($(this).parent()),i.animate({opacity:1},500)}),$("#paymentConditionItem").on("click",".project-item-del",i(".data-dom"));var o=$("#contractUpload"),v=$("#contarctFiles");o.on("change",function(){var e=$(this)[0].files[0];if(void 0!==(void 0===e?"undefined":_typeof(e))){(new FormData).append("image",e);var i=$("<img>");i.attr("src",window.URL.createObjectURL(e)),v.append(i)}}),n($("input")),n($("textarea"))});